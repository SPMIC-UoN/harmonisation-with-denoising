Bootstrap: docker
From: continuumio/miniconda3

%post
    . /opt/conda/etc/profile.d/conda.sh

    conda create -y -n power-calc-env -c conda-forge \
        python=3.11 \
        numpy \
        scipy \
        pymc=5.10.4 \
        arviz \
        tqdm \
        pandas \
        matplotlib

    conda clean -afy

%environment
    # Explicitly set environment paths
    export PATH="/opt/conda/envs/power-calc-env/bin:$PATH"
    export PYTHONPATH="/opt/conda/envs/power-calc-env/lib/python3.11/site-packages:$PYTHONPATH"

%runscript
    # Run python from the env directly
    exec /opt/conda/envs/power-calc-env/bin/python3 "$@"
